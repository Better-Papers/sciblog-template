name: Deployment

on:
  push:
    branches:
      - main
  pull_request:
  release:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - uses: actions/checkout@v3
        with:
          repository: Better-Papers/sciblog
          ref: main
          path: actions/sciblog

      - uses: actions/setup-node@v2
        with:
          node-version: "18"
          cache: "npm"
          cache-dependency-path: "actions/sciblog/package-lock.json"

      - run: |
          rm -rf actions/sciblog/src/posts/*
          rsync -av --progress --exclude="actions" . actions/sciblog/src/posts/

      #   - uses: actions/cache@v3
      #     with:
      #       path: |
      #         node_modules
      #       key: ${{ runner.os }}-${{ hashFiles('package-lock.json') }}

      - name: Install dependencies and build
        run: |
          cd actions/sciblog
          npm ci
          npm run build

      - name: Deploy ðŸš€
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: actions/sciblog/build
